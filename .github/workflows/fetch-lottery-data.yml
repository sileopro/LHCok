name: 抓取福利彩票数据

on:
  schedule:
    # 每天21:00~21:50高频抓取（每10分钟一次）
    # UTC时间 = 北京时间 - 8，所以21:00 北京时间 = 13:00 UTC
    - cron: '0,10,20,30,40,50 13 * * *'  # 21:00-21:50 北京时间
    # 其他时间低频抓取（每小时一次）
    - cron: '0 * * * *'
  workflow_dispatch: # 允许手动触发

jobs:
  fetch-data:
    runs-on: ubuntu-latest
    steps:
      - name: 检出代码
        uses: actions/checkout@v3
      
      - name: 设置Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
      
      - name: 安装依赖
        run: |
          pip install requests beautifulsoup4 lxml
      
      - name: 抓取数据
        run: python fetch_lottery.py
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: 提交更改
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          # 检查是否有文件需要提交
          if [ -d "fc" ] && [ -n "$(ls -A fc/*.txt 2>/dev/null)" ]; then
            git add fc/*.txt
            if git diff --staged --quiet; then
              echo "没有更改需要提交"
            else
              git commit -m "自动更新彩票数据 [$(date +'%Y-%m-%d %H:%M:%S')]"
              git push
            fi
          else
            echo "没有数据文件需要提交"
          fi

